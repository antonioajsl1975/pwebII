<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Finalizar Compra</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#cep').on('blur', function() {
        var cep = $(this).val().replace(/[^0-9]/g, '');
        if (cep.length === 8) {
          $.getJSON('/buscar-endereco', { cep: cep }, function(dados) {
            if (!('erro' in dados)) {
              $('#rua').val(dados.logradouro);
              $('#cidade').val(dados.localidade);
              $('#estado').val(dados.uf);
            } else {
              alert('CEP não encontrado!');
            }
          });
        }
      });
    });
  </script>
</head>
<body>
<h2>Finalizar Compra</h2>
<form action="/vendas/finalizar" method="post">
  <label for="cliente">Selecione o Cliente:</label>
  <select id="cliente" name="clienteId" required>
    <option th:each="cliente : ${clientes}"
            th:value="${cliente.id}"
            th:text="${cliente.nome}">
    </option>
  </select>

  <label for="cep">CEP:</label>
  <input type="text" id="cep" name="cep" required>

  <label for="rua">Rua:</label>
  <input type="text" id="rua" name="rua" readonly>

  <label for="cidade">Cidade:</label>
  <input type="text" id="cidade" name="cidade" readonly>

  <label for="estado">Estado:</label>
  <input type="text" id="estado" name="estado" readonly>

  <label for="formaPagamento">Forma de Pagamento:</label>
  <select id="formaPagamento" name="formaPagamento" required>
    <option value="cartao">Cartão de Crédito</option>
    <option value="boleto">Boleto Bancário</option>
    <option value="pix">Pix</option>
  </select>

  <button type="submit">Finalizar Compra</button>
</form>
</body>
</html>